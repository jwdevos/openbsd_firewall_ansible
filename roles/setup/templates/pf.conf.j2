# Generated by ansible

# define macros for interfaces and networks
int_if = "{{% for int in interfaces%}
{% if interfaces.get(int).fw == "internal" %}
{{ int }}, 
{% endif %}
{% endfor %}}"











# define a macro for internal interfaces
int_if = "{ em1, em2, em3 }"
int_subnets = "{ em1:network, em2:network, em3:network }"
dmz_if = "{ em4 }"
dmz_subnet = "{ 217.63.74.128/28 }"

# define basic IPv6 ICMP types (packet too big, echo request)
icmp6_types = "{ 2, 128 }"

# define IPv6 NDP ICMP types (RS, RA, NS, NA, redir)
icmp6_ndp_types = "{ 133, 134, 135, 136, 137 }"

# define a table with addresses that should not be routed
# including RFC 1918
table <martians> { 0.0.0.0/8,        10.0.0.0/8,      127.0.0.0/8,     \
                   169.254.0.0/16,   172.16.0.0/12,   192.0.0.0/24,    \
                   192.0.2.0/24,     224.0.0.0/3,     192.168.0.0/16,  \
                   198.18.0.0/15,    198.51.100.0/24, 203.0.113.0/24 }

# don't send RST for dropped packets
set block-policy drop

# set interfaces that will have packet and byte statistics collected
set loginterface egress

#omit lo0 interface from packet processing in PF
set skip on lo0

# scrub all incoming packets, clearing dnf bit, randomizing packet id
# and setting max mtu to 1440
match in all scrub (no-df random-id max-mss 1440)

# enable NAT from every other network than egress to egress
match out on egress inet from $int_subnets to any nat-to (egress:0)

# block incoming packets from addresses that should not be routed
block in quick on egress from <martians> to any

# block outgoing packets on egress to addresses that should not be routed
#block return out on egress from any to <martians>

# default deny rule
block all

# Allow incoming icmp6
pass in quick on em0 inet6 proto ipv6-icmp icmp6-type $icmp6_types

# Allow incoming icmp6 NDP
pass in quick on em0 inet6 proto ipv6-icmp icmp6-type $icmp6_ndp_types

# Allow incoming DHCPv6
pass in quick on em0 inet6 proto udp to port 546

#allow incoming ping
pass in quick on em0 inet proto icmp icmp-type echoreq

# allow outgoing traffic on any interface
pass out quick inet
pass out quick inet6

# allow all traffic from internal interfaces to pass
pass in on $int_if inet
pass in on $int_if inet6
pass in on em4 inet
pass in on em4 inet6

#allow all traffic from internal interfaces to dmz
pass out on $int_if from $int_subnets to $dmz_subnet

# allow ssh to outside interface from any ip
pass in on egress inet proto tcp from any to (egress) port 22

# port forward example
#pass in on egress inet proto tcp from any to (egress) port { 80 443 } rdr-to 192.168.1.2

