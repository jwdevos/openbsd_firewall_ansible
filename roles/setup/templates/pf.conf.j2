# Generated by ansible

# define macros for interfaces and networks
internal_ints = "{ {% for int in interfaces if interfaces.get(int).fw == "internal" %}
{% if not loop.last %}{{ int }}, {% endif %}
{% if loop.last %}{{ int }} {% endif %}
{% endfor %}
}"
internal_nets = "{ {% for int in interfaces if interfaces.get(int).fw == "internal" %}
{% if not loop.last %}{{ int }}:network, {% endif %}
{% if loop.last %}{{ int }}:network {% endif %}
{% endfor %}
external_int = "{% for int in interfaces %}
{% if interfaces.get(int).fw == "external" %}{{ int }}{% endif %}
{% endfor %}"
external_net = "{% for int in interfaces %}
{% if interfaces.get(int).fw == "external" %}{{ int }}:network{% endif %}
{% endfor %}"

# don't send RST for dropped packets
set block-policy drop

#omit lo0 interface from being processed in pf
set skip on lo0

# IPv4 NAT to outside rule
match out on $external_int inet from $internal_nets nat-to ($external_int)

# default deny rule
block all

#allow incoming ping on external_int
pass in on $external_int inet proto icmp icmp-type echoreq

# allow ssh to external_int from any ip
pass in on $external_int inet proto tcp from any to ($external_int) port 22

# allow outgoing traffic
pass from { self, $internal_nets }

# allow ssh to external_int from any ip
pass in on $external_int inet proto tcp from any to ($external_int) port 22
