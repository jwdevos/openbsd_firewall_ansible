# Generated by ansible

# define macros for interfaces and networks
int_if = "{ {% for int in interfaces %}
{% if interfaces.get(int).fw == "internal" %}{{ int }}, {% endif %}
{% endfor %} }"
int_subnets = "{ {% for int in interfaces %}
{% if interfaces.get(int).fw == "internal" %}{{ int }}:network, {% endif %}
{% endfor %} }"
ext_if = "{ {% for int in interfaces %}
{% if interfaces.get(int).fw == "external" %}{{ int }}, {% endif %}
{% endfor %} }"
ext_subnets = "{ {% for int in interfaces %}
{% if interfaces.get(int).fw == "external" %}{{ int }}:network, {% endif %}
{% endfor %} }"

# define a table with forbidden external subnets
table <forbidden> { {% for net in forbidden_nets %}{{ net }}, {% endfor %} }

# don't send RST for dropped packets
set block-policy drop

#omit lo0 interface from being processed in pf
set skip on lo0

# scrub all incoming packets, clearing dnf bit, randomizing packet id
# and setting max mss to 1440
match in all scrub (no-df random-id max-mss 1440)

# enable NAT from every other network than egress to egress
match out on egress inet from $int_subnets to any nat-to (egress:0)

# block incoming packets from addresses that should not be routed
block in quick on egress from <martians> to any

# block outgoing packets on egress to addresses that should not be routed
#block return out on egress from any to <martians>

# default deny rule
block all

#allow incoming ping
pass in quick on em0 inet proto icmp icmp-type echoreq

# allow outgoing traffic on any interface
pass out quick inet

# allow all traffic from internal interfaces to pass
pass in on $int_if inet
pass in on em4 inet

# allow ssh to outside interface from any ip
pass in on egress inet proto tcp from any to (egress) port 22
